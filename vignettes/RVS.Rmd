---
title: "The RVS (Rare Variant Sharing) Package"
author: "Alexandre Bureau, Ingo Ruczinski, Samuel Younkin, Thomas Sherman"
data: "`r Sys.Date()`"
package: "`r pkg_ver('RVS')`"
bibliography: References.bib
vignette: >
    %\VignetteIndexEntry{The RVS Package}
    %\VignetteEngine{knitr::rmarkdown}
    %\VignetteEncoding{UTF-8}
output:
    BiocStyle::html_document
---

```{r include=FALSE, cache=FALSE}
library(RVS)
library(kinship2)
```

Four different family types, three families from each type.
```{r}
data(samplePedigrees)
fam_type_1 <- samplePedigrees$secondCousinTriple
fam_type_2 <- samplePedigrees$firstCousinTriple
fam_type_3 <- samplePedigrees$secondCousinPair
fam_type_4 <- samplePedigrees$firstCousinPair
num_families <- 3
```

20 total variants.
```{r}
num_variants <- 20
potential_pvalue <- rep(NA, num_variants)
```

Variants in family type 1 (three second cousins)

```{r}
p1 <- suppressMessages(RVsharing(fam_type_1))
x1 <- matrix(0, ncol=num_variants, nrow=num_families * sum(fam_type_1$affected))
carriers_1 <- rep(which(fam_type_1$affected==1), num_families)
famid_1 <- rep(fam_type_1$famid[1], nrow(x1))

x1[1:6, 1] <- 1
x1[1:3, 2] <- 1
x1[1:2, 3] <- 1
x1[c(1:2,5:6), 4] <- 1
potential_pvalue[1:4] <- c(p1^2, p1, p1, p1^2)
```

Variants in family type 2 (three first cousins)
```{r}
p2 <- suppressMessages(RVsharing(fam_type_2))
x2 <- matrix(0, ncol=num_variants, nrow=num_families * sum(fam_type_2$affected))
carriers_2 <- rep(which(fam_type_2$affected==1), num_families)
famid_2 <- rep(fam_type_2$famid[1], nrow(x2))

x2[1:6, 5] <- 1
x2[1:3, 6] <- 1
x2[1:2, 7] <- 1
x2[c(1:2,5:6), 8] <- 1
potential_pvalue[5:8] <- c(p2^2, p2, p2, p2^2)
```

Variants in family type 3 (two second cousins)
```{r}
p3 <- suppressMessages(RVsharing(fam_type_3))
x3 <- matrix(0, ncol=num_variants, nrow=num_families * sum(fam_type_3$affected))
carriers_3 <- rep(which(fam_type_3$affected==1), num_families)
famid_3 <- rep(fam_type_3$famid[1], nrow(x3))

x3[1:4,     9] <- 1
x3[1:2,    10] <- 1
x3[1,      11] <- 1
x3[c(1,3), 12] <- 1
potential_pvalue[9:12] <- c(p3^2, p3, p3, p3^2)
```

Variants in family type 4 (two first cousins)
```{r}
p4 <- suppressMessages(RVsharing(fam_type_4))
x4 <- matrix(0, ncol=num_variants, nrow=num_families * sum(fam_type_4$affected))
carriers_4 <- rep(which(fam_type_4$affected==1), num_families)
famid_4 <- rep(fam_type_4$famid[1], nrow(x4))

x4[1:4,    13] <- 1
x4[1:2,    14] <- 1
x4[1,      15] <- 1
x4[c(1,3), 16] <- 1
potential_pvalue[13:16] <- c(p4^2,p4,p4,p4^2)
```

Variants in multiple family types
```{r}
x1[7:9, 17] <- 1
x2[8:9, 17] <- 1
x3[5:6, 17] <- 1
x4[5,   17] <- 1
potential_pvalue[17] <- p1*p2*p3*p4

x2[7, 18] <- 1
x4[6, 18] <- 1
potential_pvalue[18] <- p2*p4

x1[7:9, 19] <- 1
x3[3:4, 19] <- 1
potential_pvalue[19] <- p1*p3

x3[5, 20] <- 1
potential_pvalue[20] <- p3
```

Matrix of all variant sharing patterns.
```{r}
x <- rbind(x1, x2, x3, x4)
famid <- c(famid_1, famid_2, famid_3, famid_4)
carriers <- c(carriers_1, carriers_2, carriers_3, carriers_4)
cbind(famid, carriers, x)
```

Calculating p-values across all variants.
```{r}
fams <- list(fam_type_1, fam_type_2, fam_type_3, fam_type_4)
pval <- multipleVariantPValue(x, famid, carriers, fams)
```

Potential p-value plot
```{r}
plot(-log10(sort(potential_pvalue)),pch=20,cex=1.3,ylab="-log10 potential p-value")
bcut <- 0.05/(1:num_variants)
lines(1:num_variants,-log10(bcut),col="red",type="b",pch=20)
lines(1:num_variants,-log10(sort(pval)),col="blue",type="b",pch=20)
```

# References